<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kilogram - User Settings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='profile.css') }}">
    <link rel="icon" href="../static/burg.png">
</head>
<body>
        <nav class="nv">
        <div class="all">


            <div class="left">
            </div>


            <div class="center">
                <a href="#" class="anc fe">Feed</a>
                <a href="#" class="anc">Categories</a>
                <a href="#" class="anc">List</a>
            </div>


            <div class="right">
                <img src="../static/icon.png" class="profile">
            </div>


        </div>
    </nav>

    <div class="tLeft">
        <h1 class="forward">></h1>
    </div>

    <div class="sideCon">
        <nav class="sidebar">
            <h1 class="back"><</h1>
            <h1 class="setTitle">Settings</h1>
            <div class="btns">
                <button class="setProfile set">Profile</button>
                <button class="setSec set">Security</button>
                <button class="setAcc set">Account</button>
            </div>

        </nav>
    </div>

    <!-- Profile Settings -->

    <div class="allSets">
        <div class="profileBox sb">
            <h1 class="sbTitle">Profile Settings</h1>
            <div class="rowed">
                <div class="leftSet">
                    <form class="image" action="{{ url_for('settings')}}" method="post" enctype="multipart/form-data">
                        <input type="file" class="fileInput" name="pfp" accept="image/*" hidden>
                        <img src="{{ current_user.pfp }}" class="setPfp" alt="User PFP">
                        <label class="lbl">Change Profile</label>
                    </form>
                    <div class="overlay"></div>
                    <h1 class="usern">{{current_user.username}}</h1>
                </div>
                <form class="centerSet" action="{{ url_for('settings') }}" method="post">
                    <label class="setLb">Change Username</label>
                    <input type="text" class="userInp changeuser" name="username" minlength="6" maxlength="20" value="{{ current_user.username }}" required >
                    <label class="setLb passLb">Password</label>
                    <input type="password" class="userInp passInp" name="password" placeholder="Password" minlength="8" maxlength="28" required>
                    <input type="submit" value="Change Username" class="change">
                </form>
            </div>
        </div>


        <div class="secBox sb">
            <h1 class="sbTitle">Security Settings</h1>
            <form class="secForm" action="{{ url_for('settings') }}" method="post">
                <label class="plbl tplbl">Current Password</label>
                <input type="password" class="inp password signpass" placeholder="Current Password" name="currentpass" minlength="8" maxlength="28" required>
                <label class="plbl">New Password</label>
                <input type="password" class="inp password signpass" placeholder="New Password" name="newpass" minlength="8" maxlength="28" required>
                <input type="submit" class="sbm" value="Change Password">
            </form>
        </div>


        <div class="accBox sb">
            <h1 class="sbTitle">Account Settings</h1>
            <div class="accBtns">
                <button class="logoutBtn accBtn">Logout</button>
                <button class="delBtn accBtn">Delete</button>
            </div>
        </div>
        <div class="deleteModalCon">
            <div class="deleteModal">
                <h1 class="sbTitle">Are You Sure?</h1>
                <button class="modBtn yes">Yes</button>
                <button class="modBtn no">No</button>
            </div>

        </div>

    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}
    {% endwith %}

    <script>
        const back = document.querySelector('.back');
        const sideCon = document.querySelector('.sideCon');
        const sidebar = document.querySelector('.sidebar');
        const forward = document.querySelector('.forward');
        const overlay = document.querySelector('.overlay');
        const lbl = document.querySelector('.lbl');
        const profile2 = document.querySelector(".profile");
        const pfp = document.querySelector('.setPfp');
        const file = document.querySelector('.fileInput');
        const fileForm = document.querySelector('.image');
        const setProfile = document.querySelector('.setProfile');
        const profileBox = document.querySelector('.profileBox');
        const setSec = document.querySelector('.setSec');
        const secBox = document.querySelector('.secBox');
        const setAcc = document.querySelector('.setAcc');
        const accBox = document.querySelector('.accBox');
        const logout = document.querySelector('.logoutBtn');
        const del = document.querySelector('.delBtn');
        const delCon = document.querySelector('.deleteModalCon');
        const delMod = document.querySelector('.deleteModal');
        const yes = document.querySelector('.yes');
        const no = document.querySelector('.no');
        const feed = document.querySelector('.fe');

        feed.addEventListener('click', ()=> {
            window.location.href = '{{ url_for("home") }}'
        })

        yes.addEventListener('click', ()=> {
            window.location.href = '{{ url_for("delete") }}';
        })

        no.addEventListener('click', ()=> {
            delCon.style.display = 'none';
        })

        del.addEventListener('click', ()=> {
            delCon.style.display = 'flex';
        })

        document.addEventListener('click', (e)=> {
            if (delCon.style.display == 'flex' && !delMod.contains(e.target) && !del.contains(e.target)) {
                delCon.style.display = 'none';
            }
        })

        logout.addEventListener('click', ()=> {
            window.location.href = '{{ url_for("logout")}}';
        })

        setProfile.classList.add('clicked');
        delCon.style.display = 'none';

        setProfile.addEventListener('click', ()=> {
            setProfile.classList.add("clicked");
            setSec.classList.remove('clicked');
            setAcc.classList.remove('clicked');

            profileBox.style.display = 'block';
            secBox.style.display = 'none';
            accBox.style.display = 'none';
        })

        setSec.addEventListener('click', ()=> {
            setProfile.classList.remove("clicked");
            setSec.classList.add('clicked');
            setAcc.classList.remove('clicked');

            profileBox.style.display = 'none';
            secBox.style.display = 'flex';
            accBox.style.display = 'none';
        })

        setAcc.addEventListener('click', ()=> {
            setProfile.classList.remove("clicked");
            setSec.classList.remove('clicked');
            setAcc.classList.add('clicked');

            profileBox.style.display = 'none';
            secBox.style.display = 'none';
            accBox.style.display = 'flex';
        })

        overlay.addEventListener('click', ()=> {
            file.click();
        })

        file.onchange = ()=> {
            fileForm.submit();
        }

        profile2.addEventListener('click', ()=> {
            console.log("settings")
            window.location.href = "{{ url_for('profile', user_id=current_user.id) }}";
        })

        overlay.addEventListener('mouseenter', ()=> {
            lbl.style.opacity = 1;
        })

        overlay.addEventListener('mouseleave', ()=> {
            lbl.style.opacity = 0;
        })

        overlay.addEventListener('click', (e)=> {
            e.stopPropagation();
        })

        forward.addEventListener('click', ()=> {
            forward.style.display = 'none';
            sidebar.classList.add('open');
        })

        back.addEventListener('click', ()=> {
            sidebar.classList.remove('open');
            forward.style.display = 'block';
        })

        document.addEventListener('click', (e)=> {
            if (forward.style.display == 'none' && !sidebar.contains(e.target) && !forward.contains(e.target)) {
                sidebar.classList.remove('open');
                forward.style.display = 'block';
                console.log("done");
            }
        })

    </script>
</body>
</html>